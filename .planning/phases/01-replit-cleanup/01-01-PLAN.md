---
phase: 01-replit-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - package.json
  - client/src/components/EditCourseForm.tsx
  - server/replitAuth.ts.backup
  - .replit

autonomous: true

must_haves:
  truths:
    - "`npm run build` completes without error after Replit Vite plugins are removed"
    - "No Replit packages remain in package.json (stripe-replit-sync, @replit/*, passport, passport-local, memorystore, openid-client, @uppy/*)"
    - "TypeScript compilation (`npm run check`) passes with no errors from removed packages"
  artifacts:
    - path: "vite.config.ts"
      provides: "Clean Vite config with no Replit plugin imports"
      contains: "defineConfig"
    - path: "package.json"
      provides: "Package manifest with unused/Replit deps removed"
    - path: "client/src/components/EditCourseForm.tsx"
      provides: "Inline UploadResult type replacing @uppy/core import"
  key_links:
    - from: "vite.config.ts"
      to: "build output"
      via: "vite build command"
      pattern: "plugins.*react"
---

<objective>
Remove all Replit-specific packages, Vite plugins, and dead dependency packages from the codebase so the project builds and type-checks cleanly without any Replit context.

Purpose: Eliminate Replit build-time dependencies that prevent the codebase from building outside Replit. This is a prerequisite for all subsequent migration work.
Output: Clean vite.config.ts, reduced package.json, no TypeScript errors from removed packages.
</objective>

<execution_context>
@/Users/jeremygill/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jeremygill/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-replit-cleanup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove Replit Vite plugins and clean vite.config.ts</name>
  <files>vite.config.ts</files>
  <action>
Rewrite vite.config.ts to remove all Replit references:

1. Remove the import: `import runtimeErrorOverlay from "@replit/vite-plugin-runtime-error-modal"`
2. Remove `runtimeErrorOverlay()` from the plugins array
3. Remove the entire conditional cartographer block (lines 10-17 that reference `process.env.REPL_ID`)
4. Keep: `react()` plugin, all resolve.alias entries, root, build, and server config

The result should look like:
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(import.meta.dirname, "client", "src"),
      "@shared": path.resolve(import.meta.dirname, "shared"),
      "@assets": path.resolve(import.meta.dirname, "attached_assets"),
    },
  },
  root: path.resolve(import.meta.dirname, "client"),
  build: {
    outDir: path.resolve(import.meta.dirname, "dist/public"),
    emptyOutDir: true,
  },
  server: {
    fs: {
      strict: true,
      deny: ["**/.*"],
    },
  },
});
```
  </action>
  <verify>Run `npx tsc --noEmit` (or `npm run check`) — vite.config.ts should not produce TypeScript errors referencing Replit modules.</verify>
  <done>vite.config.ts contains no Replit imports or REPL_ID references. Only react() plugin remains.</done>
</task>

<task type="auto">
  <name>Task 2: Uninstall dead packages, fix type imports, delete dead files</name>
  <files>package.json, client/src/components/EditCourseForm.tsx, server/replitAuth.ts.backup, .replit</files>
  <action>
1. **Fix the UploadResult type import BEFORE uninstalling Uppy** — in `client/src/components/EditCourseForm.tsx` line 20, replace:
   ```typescript
   import type { UploadResult } from "@uppy/core";
   ```
   with an inline type definition:
   ```typescript
   type UploadResult = { successful: Array<{ uploadURL: string }> };
   ```
   This matches how ObjectUploader.tsx constructs the result object.

2. **Uninstall all dead/Replit packages** in a single npm command:
   ```bash
   npm uninstall stripe-replit-sync @replit/vite-plugin-runtime-error-modal @replit/vite-plugin-cartographer passport passport-local memorystore openid-client @uppy/aws-s3 @uppy/core @uppy/dashboard @uppy/react
   npm uninstall --save-dev @types/passport @types/passport-local
   ```

   DO NOT remove: `@google-cloud/storage` (Plan 03 handles this), `moment` (actively used in 4 client files), `openai` (kept per decision for future use), `node-cron` (Phase 3 concern), `memoizee` (needs audit first — leave for now).

3. **Delete dead files:**
   - `server/replitAuth.ts.backup` — dead Replit auth backup, not imported anywhere
   - `.replit` — Replit deployment config, no longer needed

4. **Verify no remaining imports** of removed packages by running TypeScript check.
  </action>
  <verify>
Run these commands in sequence:
1. `npm run check` — TypeScript compilation succeeds with no errors from removed packages
2. `npm run build` — Vite build completes without error
3. `grep -r "stripe-replit-sync\|@replit/\|passport\|memorystore\|openid-client\|@uppy/" package.json` — returns no matches
  </verify>
  <done>All listed packages removed from package.json. EditCourseForm.tsx uses inline UploadResult type. replitAuth.ts.backup and .replit files deleted. `npm run build` succeeds. `npm run check` passes.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without error
2. `npm run check` (TypeScript) passes with no errors
3. No Replit package names appear in package.json
4. `server/replitAuth.ts.backup` does not exist
5. `.replit` does not exist
6. vite.config.ts has no Replit imports
</verification>

<success_criteria>
The project builds (`npm run build`) and type-checks (`npm run check`) successfully with all Replit Vite plugins and unused packages removed. No Replit-specific packages remain in package.json dependencies or devDependencies.
</success_criteria>

<output>
After completion, create `.planning/phases/01-replit-cleanup/01-01-SUMMARY.md`
</output>
